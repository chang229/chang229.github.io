<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="常红达的个人博客">
  <meta name="keywords" content="">
  
    <link rel="icon" href="http://img2.ph.126.net/T5EUfn4iMZCILs9MDPuSvA==/6597839424798151772.png">
  
    
  <title>JS中判断对象是不是数组的方法 | 常红达的博客</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/lib/jquery.fancybox.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>常红达的博客</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>JS中判断对象是不是数组的方法</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2018年02月02日</time>
            
              | <i class="fa fa-folder-open-o" aria-hidden="true"></i> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/js/">js</a>
  </div>



            
            
              | 
                  <i class="fa fa-tag" aria-hidden="true"></i>
                
               
  <a href="/tags/#js" class='tag'>js</a>


            
          </div>
          <p>今天有同事突然问到如何判断一个对象是不是数组，当时只想到啦<code>instanceof</code>操作符，后来又搜集了一些文章，总结出以下方法。</p>
<h4 id="一、typeof-操作符"><a href="#一、typeof-操作符" class="headerlink" title="一、typeof 操作符"></a>一、typeof 操作符</h4><p>在js中使用<code>typeof</code>操作符来判断<code>function string number boolean undefined</code>等是没有问题的。但是如果要检测Array就没有作用了，因为<code>typeof</code>判断<code>array</code>和<code>null</code>的结果都是<code>object</code>。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alert(typeof null); // &quot;object&quot;</span><br><span class="line">alert(typeof function () &#123;</span><br><span class="line">return 1;</span><br><span class="line">&#125;); // &quot;function&quot;</span><br><span class="line">alert(typeof &apos;abcd&apos;); // &quot;string&quot;</span><br><span class="line">alert(typeof true); //boolean</span><br><span class="line">alert(typeof 1); // &quot;number&quot;</span><br><span class="line">alert(typeof a); // &quot;undefined&quot;</span><br><span class="line">alert(typeof undefined); // &quot;undefined&quot;</span><br><span class="line">alert(typeof []); // &quot;object&quot;</span><br></pre></td></tr></table></figure></p>
<h4 id="二、instanceof-操作符"><a href="#二、instanceof-操作符" class="headerlink" title="二、instanceof 操作符"></a>二、instanceof 操作符</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var arr = [];</span><br><span class="line">console.log(arr instanceof Array);</span><br></pre></td></tr></table></figure>
<p><code>arr instanceof Array</code>的含义是：判断<code>Array</code>的<code>prorotype</code>属性是不是在<code>arr</code>的原型链上，是返回<code>true</code>,否返回<code>false</code>;</p>
<h4 id="三、对象的constructor属性"><a href="#三、对象的constructor属性" class="headerlink" title="三、对象的constructor属性"></a>三、对象的constructor属性</h4><p>除了instanceof，每个对象还有constructor的属性，利用它似乎也能进行Array的判断<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var arr = [];</span><br><span class="line">console.log(arr.constructor === Array);</span><br></pre></td></tr></table></figure></p>
<h4 id="四、instanceof-和-constructor-的缺陷"><a href="#四、instanceof-和-constructor-的缺陷" class="headerlink" title="四、instanceof 和 constructor 的缺陷"></a>四、instanceof 和 constructor 的缺陷</h4><p>通过使用 instanceof 和 constructor 来判断对象是不是数组，在大多数情况下是可以的，但实际上也还是有缺陷的，当页面上有多个<code>frame</code>,需要在多个iframe中来回切换时，这种方法的缺陷就表现出来啦。</p>
<blockquote>
<p>由于每个iframe都有一套自己的执行环境，跨frame实例化的对象彼此是不共享原型链的，因此导致<code>instanceof</code>和<code>constructor</code>失效。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var iframe = document.createElement(&apos;iframe&apos;); //创建iframe</span><br><span class="line">document.body.appendChild(iframe); //添加到body中</span><br><span class="line">xArray = window.frames[window.frames.length-1].Array;</span><br><span class="line">var arr = new xArray(1,2,3); // 声明数组[1,2,3]</span><br><span class="line">alert(arr instanceof Array); // false</span><br><span class="line">alert(arr.constructor === Array); // false</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="五、Object-prototype-toString"><a href="#五、Object-prototype-toString" class="headerlink" title="五、Object.prototype.toString"></a>五、Object.prototype.toString</h4><p>Object.prototype.toString的行为：首先，取得对象的一个内部属性[[Class]]，然后依据这个属性，返回一个类似于”[object Array]”的字符串作为结果(看过ECMA标准的应该都知道，[[]]用来表示语言内部用到的、外部不可直接访问的属性，称为“内部属性”)。利用这 个方法，再配合call，我们可以取得任何对象的内部属性[[Class]]，然后把类型检测转化为字符串比较，以达到我们的目的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function isArrayFn (o) &#123;</span><br><span class="line">return Object.prototype.toString.call(o) === &apos;[object Array]&apos;;</span><br><span class="line">&#125;</span><br><span class="line">var arr = [1,2,3,1];</span><br><span class="line">alert(isArrayFn(arr));// true</span><br></pre></td></tr></table></figure>
<p>call改变toString的this引用为待检测的对象，返回此对象的字符串表示，然后对比此字符串是否是’[object Array]’，以判断其是否是Array的实例。为什么不直接o.toString()?嗯，虽然Array继承自Object，也会有 toString方法，但是这个方法有可能会被改写而达不到我们的要求，而Object.prototype则是老虎的屁股，很少有人敢去碰它的，所以能一定程度保证其“纯洁性”：)</p>
<p>JavaScript 标准文档中定义: [[Class]] 的值只可能是下面字符串中的一个： Arguments, Array, Boolean, Date, Error, Function, JSON, Math, Number, Object, RegExp, String.<br>这种方法在识别内置对象时往往十分有用，但对于自定义对象请不要使用这种方法。</p>
<h4 id="六、Array-isArray"><a href="#六、Array-isArray" class="headerlink" title="六、Array.isArray()"></a>六、Array.isArray()</h4><p>ECMAScript5中引入了Array.isArray()方法，用于专门判断一个对象是不是数组，是返回<code>true</code>，不是返回<code>false</code>;目前所有主流浏览器和IE9+都对其进行了支持，IE8及以下浏览器不支持该方法。</p>
<h4 id="七、一种最佳的判断方法"><a href="#七、一种最佳的判断方法" class="headerlink" title="七、一种最佳的判断方法"></a>七、一种最佳的判断方法</h4><p>综合以上方法的优缺点，可以有一个最佳的判断数组的写法：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var arr = [1,2,3,1];</span><br><span class="line">var arr2 = [&#123; abac : 1, abc : 2 &#125;];</span><br><span class="line">function isArrayFn(value)&#123;</span><br><span class="line">    if (typeof Array.isArray === &quot;function&quot;) &#123;</span><br><span class="line">        return Array.isArray(value);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return Object.prototype.toString.call(value) === &quot;[object Array]&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">console.log(isArrayFn(arr));// true</span><br><span class="line">console.log(isArrayFn(arr2));// true</span><br></pre></td></tr></table></figure></p>

        </section>
    </article>
    
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>目录</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#一、typeof-操作符"><span class="toc-number">1.</span> <span class="toc-text">一、typeof 操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#二、instanceof-操作符"><span class="toc-number">2.</span> <span class="toc-text">二、instanceof 操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#三、对象的constructor属性"><span class="toc-number">3.</span> <span class="toc-text">三、对象的constructor属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#四、instanceof-和-constructor-的缺陷"><span class="toc-number">4.</span> <span class="toc-text">四、instanceof 和 constructor 的缺陷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#五、Object-prototype-toString"><span class="toc-number">5.</span> <span class="toc-text">五、Object.prototype.toString</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#六、Array-isArray"><span class="toc-number">6.</span> <span class="toc-text">六、Array.isArray()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#七、一种最佳的判断方法"><span class="toc-number">7.</span> <span class="toc-text">七、一种最佳的判断方法</span></a></li></ol>
        </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy; 2018 | 我的个人博客 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="/lib/jquery.fancybox.min.js"></script>


</body>
</html>
